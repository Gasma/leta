@model leta.webApp.Models.RouteTimeViewModel

<h4>Adiciona Registros</h4>
<hr />
<div class="row">
    <div class="col-md-6" id="list">
        <table id="tabela" class="table table-striped table-bordered nowrap" style="width:100% !important">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Hora do Dia</th>
                    <th>Dia da Semana</th>
                    <th>Tempo</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="col-md-3">
        <form id="addRegistroUnico">
            <div class="form-group">
                <label for="HoraDoDia" class="control-label">Hora do dia</label>
                <input type="datetime-local" name="HoraDoDia" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="DiaDaSemana" class="control-label">Dia da Semana</label>
                <input asp-for="DiaDaSemana" class="form-control" required/>
            </div>
            <div class="form-group">
                <label for="Tempo" class="control-label">Tempo</label>
                <input name="Tempo" type="number" min="0" class="form-control" required />
            </div>
            <div class="form-group">
                <input type="button" name="SalvaRegistroUnico" id="SalvaRegistroUnico" value="Adicionar" class="btn btn-primary" />
            </div>
        </form>
    </div>
    <div class="col-md-3">
        <form id="arquivo">
            <div class="form-group">
                <label for="AddArquivo" class="control-label">Adiciona CSV</label>
                <input type="file" name="Arquivo" class="form-control" />
            </div>
            <div class="form-group">
                <input type="button" value="Adicionar" id="SalvaArquivo" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Pagina inicial</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.24/datatables.min.js"></script>
    <script>
        var tabela = $('#tabela').DataTable({
            dom: "<'row'<'col-sm-12'>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12'p>>",
            language: {
                "sEmptyTable": "Nenhum registro encontrado",
                "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
                "sInfoFiltered": "(Filtrados de _MAX_ registros)",
                "sInfoPostFix": "",
                "sInfoThousands": ".",
                "sLengthMenu": "_MENU_ resultados por página",
                "sLoadingRecords": '<img src="/ajax-loader.gif"/>',
                "sProcessing": '<img src="/ajax-loader.gif"/>',
                "sZeroRecords": "Nenhum registro encontrado",
                "sSearch": "Pesquisar",
                "oPaginate": {
                    "sNext": "&raquo;",
                    "sPrevious": "&laquo;",
                    "sLast": "Último"
                },
                "oAria": {
                    "sSortAscending": ": Ordenar colunas de forma ascendente",
                    "sSortDescending": ": Ordenar colunas de forma descendente"
                }
            },
            processing: true,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
            pageLength: 10,
            ajax: {
                url: "/Home/PopulaTabela/",
                dataType: "json"
            },
            columns: [
                { data: 'id', name: 'id', width: "2%" },
                { data: 'horaDoDia', name: 'HoraDoDia' },
                { data: 'diaDaSemana', name: 'DiaDaSemana' },
                { data: 'tempo', name: 'Tempo' },
            ]
        });

        $("#SalvaRegistroUnico").on("click", function () {
            $.ajax({
                type: "POST",
                url: "/Home/SalvaUnicoRegistro",
                dataType: 'json',
                data: $("#addRegistroUnico").serialize()
            });
            tabela.draw();
        });

        $("#SalvaArquivo").on("click", function () {
            var addfiles = new FormData($("#arquivo")[0]);
            $.ajax({
                enctype: 'multipart/form-data',
                data: addfiles,
                url: "/Home/SalvaArquivo",
                contentType: false,
                processData: false,
                type: "POST"
            });
            tabela.draw();
        });
    </script>
}
